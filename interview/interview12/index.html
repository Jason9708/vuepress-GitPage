<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>requestAnimationFrame | CHICAGO</title>
    <meta name="description" content="前端仔的自我挣扎">
    <link rel="icon" href="/vuepress-GitPage/logo/favicon.ico">
    
    <link rel="preload" href="/vuepress-GitPage/assets/css/0.styles.01a33ba5.css" as="style"><link rel="preload" href="/vuepress-GitPage/assets/js/app.37ca189d.js" as="script"><link rel="preload" href="/vuepress-GitPage/assets/js/2.155b04c3.js" as="script"><link rel="preload" href="/vuepress-GitPage/assets/js/34.40efca14.js" as="script"><link rel="prefetch" href="/vuepress-GitPage/assets/js/10.46b0086b.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/11.daa4a2a6.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/12.6b9c3e62.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/13.5c18fc57.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/14.e416db64.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/15.eea646e9.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/16.c3ddacbb.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/17.9c92be23.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/18.1cef88cc.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/19.0007bb60.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/20.ad873dd4.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/21.5c85b951.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/22.1832ea7c.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/23.2ed17f39.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/24.dc466810.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/25.320dfa10.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/26.41238810.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/27.a9e293a0.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/28.440fd059.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/29.d7f07814.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/3.22f6a7dc.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/30.fb22e215.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/31.ddcc866e.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/32.c8af0786.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/33.f19150ca.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/35.1ab28b4a.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/36.003bb1fe.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/37.6bf9045f.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/38.525fc624.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/39.b5dfca7e.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/4.310e4e99.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/40.79c4b5aa.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/41.0a309ba6.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/42.015a20c9.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/5.10910fab.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/6.9de72c04.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/7.c8439b32.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/8.9911e584.js"><link rel="prefetch" href="/vuepress-GitPage/assets/js/9.79c793b2.js">
    <link rel="stylesheet" href="/vuepress-GitPage/assets/css/0.styles.01a33ba5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-GitPage/" class="home-link router-link-active"><!----> <span class="site-name">CHICAGO</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-GitPage/interview/" class="nav-link router-link-active">前端面试专栏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端小册" class="dropdown-title"><span class="title">前端小册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/designpattern/" class="nav-link">Designpattern</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/handwrittenScript/" class="nav-link">常见前端面试手写题</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/flutterNote/" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Jason9708" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-GitPage/interview/" class="nav-link router-link-active">前端面试专栏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端小册" class="dropdown-title"><span class="title">前端小册</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/webpack/" class="nav-link">Webpack</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/designpattern/" class="nav-link">Designpattern</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/handwrittenScript/" class="nav-link">常见前端面试手写题</a></li><li class="dropdown-item"><!----> <a href="/vuepress-GitPage/flutterNote/" class="nav-link">Flutter</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Jason9708" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuepress-GitPage/interview/" class="sidebar-link">前端面试专栏</a></li><li><a href="/vuepress-GitPage/interview/interview01/" class="sidebar-link">2020 / 3 / 6</a></li><li><a href="/vuepress-GitPage/interview/interview02/" class="sidebar-link">2020 / 3 / 7</a></li><li><a href="/vuepress-GitPage/interview/interview03/" class="sidebar-link">2020 / 3 / 8</a></li><li><a href="/vuepress-GitPage/interview/interview04/" class="sidebar-link">2020 / 3 / 9</a></li><li><a href="/vuepress-GitPage/interview/interview05/" class="sidebar-link">2020 / 3 / 10</a></li><li><a href="/vuepress-GitPage/interview/interview06/" class="sidebar-link">2020 / 3 / 15</a></li><li><a href="/vuepress-GitPage/interview/interview07/" class="sidebar-link">2020 / 3 / 16</a></li><li><a href="/vuepress-GitPage/interview/interview08/" class="sidebar-link">2020 / 3 / 17</a></li><li><a href="/vuepress-GitPage/interview/interview09/" class="sidebar-link">2020 / 3 / 19</a></li><li><a href="/vuepress-GitPage/interview/interview10/" class="sidebar-link">2020 / 3 / 21</a></li><li><a href="/vuepress-GitPage/interview/interview11/" class="sidebar-link">2020 / 3 / 22</a></li><li><a href="/vuepress-GitPage/interview/interview12/" class="active sidebar-link">requestAnimationFrame</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="requestanimationframe"><a href="#requestanimationframe" class="header-anchor">#</a> requestAnimationFrame</h1> <blockquote><p>附原帖地址：<a href="https://juejin.im/post/5c3ca3d76fb9a049a979f429">https://juejin.im/post/5c3ca3d76fb9a049a979f429</a></p></blockquote> <blockquote><p>在web应用中，实现动画效果的方法比较多，Javascript中可以通过定时器setTimeout来实现，css3可以使用transition和animation来实现，html5中的canvas也可以实现。除此之外，html5还提供了一个专门用于请求动态的Api，即requestAnimationFrame</p></blockquote> <h4 id="_1-什么是-requestanimationframe"><a href="#_1-什么是-requestanimationframe" class="header-anchor">#</a> 1 / 什么是 requestAnimationFrame</h4> <ul><li>HTML5新增的API，类似于setTimeout定时器</li> <li>window对象的一个方法，window.requestAnimationFrame</li> <li>浏览器专门为动画提供的Api，让Dom动画，Canvas动画，SVG动画，WebGL动画等有一个统一的刷新机制（因此只能用于浏览器）</li></ul> <h4 id="_2-requestanimationframe做了什么？"><a href="#_2-requestanimationframe做了什么？" class="header-anchor">#</a> 2 / requestAnimationFrame做了什么？</h4> <ul><li>浏览器重绘频率一般会在和显示器的刷新率保持同步。大多数浏览器采取W3C规范的建议，浏览器的渲染页面的标准帧率也为60FPS</li> <li>按帧对网页进行重绘 ：该方法告诉浏览器希望执行动画并请求浏览器在下一次重绘之前调用回调函数来更新动画</li> <li>由系统来决定回调函数的执行时机 ：在运行时浏览器会自动优化方法的调用
<ul><li>显示器有固定的刷新频率（60/75hz），也就是说，每秒最多只能重绘60次或75次，requestAnimationFrame的基本思想<strong>让页面重绘的频率与这个刷新率保持同步</strong> <ul><li>比如显示器屏幕刷新频率为60Hz，使用requestAnimationFrame Api，那么回调函数就每 1000ms / 60 = 16.7ms 执行一次；如果显示器屏幕的刷新率为75Hz，那么回调函数就每 1000ms / 75 = 13.3ms 执行一次</li></ul></li> <li>通过requestAnimationFrame调用回调函数引起的页面重绘或回流的时间间隔和显示器的刷新时间间隔相同，所以requestAnimation不需要像setTimeout那样传递时间间隔，而是由浏览器通过系统获取并使用显示器刷新频率</li></ul></li></ul> <h4 id="_3-requestanimation用法"><a href="#_3-requestanimation用法" class="header-anchor">#</a> 3 / requestAnimation用法</h4> <blockquote><p>动画帧请求回调函数列表：每个Document都有一个动画帧请求回调函数列表，该列表可以看成是由&lt;handle, callback&gt;元组组成的集合</p></blockquote> <ul><li>handle 是一个整数，唯一地标识了元组在列表中的位置， cancelAnimationFrame() 可以通过它来停止动画</li> <li>callback 是一个无返回值的、形参为一个时间值的函数</li> <li>刚开始该列表为空</li></ul> <blockquote><p>页面可见性</p></blockquote> <ul><li>当页面被最小化或者被切换为后台标签页时，页面为不可见，浏览器会触发一个 visibilitychange 事件，并设置 document.hidden 属性为 true</li> <li>当页面切换到显示状态，页面变为可见，同时触发一个 visibilitychange 事件，设置 document.hidden 属性为 false</li></ul> <hr> <ul><li>调用操作
<ul><li>与 <code>setTimeout</code> 相似，但是不需要设置间隔时间，使用一个回调函数作为参数，返回一个大于0的整数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>handle <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><pre><code>  - callback，是一个回调函数，在下次重绘动画时调用，该回调函数接收唯一参数，是一个高精度时间戳，指触发回调函数的当前时间（不用手动传入）
  - 返回值是一个long型的非零整数，是requestAnimationFrame回调函数列表中唯一的标识，表示定时器的编号，无其他意义
</code></pre></li> <li>取消操作<div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">cancelAnimation</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><pre><code>  - 参数是调用requestAnimationFrame时的返回值（唯一标识）
  - 取消操作没有返回值
</code></pre></li> <li>浏览器执行过程
<ul><li>首先判断document.hidden属性是否为true（页面是否可见），页面处于可见状态才会执行后面的步骤</li> <li>浏览器清空上一轮的动画函数</li> <li>requestAnimationFrame将回调函数追加到动画帧请求回调函数列表的末尾
<ul><li>当执行<code>requestAnimationFrame(callback)</code>的时候，不会立即调用 callback 函数，只是将其放入队列，每个回调函数都有一个boolean标识<code>cancelled</code>，该标识初始值为false，并且对外不可见</li> <li>当浏览器再执行列表中的回调函数得时候，判断每个元组的callback的<code>cancelled</code>，如果为false，则执行callback。（当页面可见并且动画帧请求回调函数列表不为空，浏览器会定期将这些回调函数加入到浏览器UI线程的队列中）</li> <li>当调用<code>cancelAnimationFrame(handle)</code>时，浏览器会设置该handle指向的回调函数的cancelled为true（无论该回调函数是否在动画帧请求回调函数列表中）。如果该handle没有指向任何回调函数，则什么也不会发生</li></ul></li></ul></li> <li>递归调用 - 想要实现一个完整的动画，应该在回调函数中递归调用回调函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">let</span> rafId <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token comment">/**
 * 回调函数
 * @param time requestAnimationFrame 调用该函数时，自动传入的一个时间
*/</span>
<span class="token keyword">function</span> <span class="token function">requestAnimation</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
    <span class="token comment">// 动画没有执行完，则递归渲染</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        count<span class="token operator">++</span>
        rafId <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>requestAnimation<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>requestAnimation<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>如果在执行回调函数或者Document的动画帧请求回调函数列表被清空之前多次调用requestAnimationFrame来调用同一个回调函数，那么列表中会有多个元组指向该回调函数（它们的handle不同，但callback都为该回调函数），'采集所有动画'任务会执行多次该回调函数。（类比定时器setTimeout）<div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> counter<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>多次点击按钮，会发现打印出来多个序列数组（如下，连续触发三次，打印三个有序列）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// reslut（截取部分）</span>
<span class="token number">1</span>
<span class="token number">20</span>
<span class="token number">10</span>
<span class="token number">2</span>
<span class="token number">21</span>
<span class="token number">11</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>如果是作用于动画，动画会出现突变的情况</li></ul></li></ul> <h4 id="_4-优势"><a href="#_4-优势" class="header-anchor">#</a> 4 / 优势</h4> <blockquote><p>requestAnimationFrame 采用系统时间间隔，保持最佳绘制效率。不会因为间隔时间过短，造成过度绘制，增加开销；也不会因为间隔时间过长，使动画卡顿</p></blockquote> <blockquote><p>从实现的功能和使用方法上，requestAnimationFrame 与 setTimeout 都相似，所以说其优势是同 setTimeout 实现的动画相比</p></blockquote> <ul><li>提升性能，防止掉帧</li> <li>节约资源，节省电源</li> <li>函数节流
<ul><li>一个刷新间隔内函数执行多次时没有意义的，因为显示器每16.7ms刷新一次，多次绘制并不会在屏幕上体现出来</li> <li>在高频事件（reszie, scroll等）中，使用requestAnimationFrame可以防止在一个刷新间隔内发送多次函数执行，这样保证了流畅性，也节省了函数执行的开销</li> <li>某些情况下可以直接使用requestAnimationFrame替代Throttle函数，都是限制回调函数执行的频率</li></ul></li></ul> <h4 id="_5-应用"><a href="#_5-应用" class="header-anchor">#</a> 5 / 应用</h4> <ul><li>简单的进度条动画</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>requestAnimation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
            <span class="token selector">#loadingBar</span> <span class="token punctuation">{</span>
                <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
                <span class="token property">background</span><span class="token punctuation">:</span> lightblue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>loadingBar<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
                <span class="token keyword">function</span> <span class="token function">loadingBar</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span>
                        <span class="token comment">// 使用闭包保存定时器的编号</span>
                    <span class="token keyword">let</span> handle<span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 每次触发将进度清空</span>
                        ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">;</span>
                        <span class="token comment">// 开始动画前清除上一次的动画定时器</span>
                        <span class="token comment">// 否则会开启多个定时器</span>
                        <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 回调函数</span>
                        <span class="token keyword">let</span> <span class="token function-variable function">_progress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            <span class="token keyword">let</span> eleWidth <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>eleWidth <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                ele<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>eleWidth <span class="token operator">+</span> <span class="token number">5</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                                handle <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>_progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                <span class="token function">cancelAnimationFrame</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        handle <span class="token operator">=</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>_progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">var</span> loadingELE <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'loadingBar'</span><span class="token punctuation">)</span>
                <span class="token function">loadingBar</span><span class="token punctuation">(</span>loadingELE<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-GitPage/interview/interview11/" class="prev">2020 / 3 / 22</a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-GitPage/assets/js/app.37ca189d.js" defer></script><script src="/vuepress-GitPage/assets/js/2.155b04c3.js" defer></script><script src="/vuepress-GitPage/assets/js/34.40efca14.js" defer></script>
  </body>
</html>
