(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{177:function(s,e,n){"use strict";n.r(e);var a=n(0),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"区分开发与生产环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#区分开发与生产环境"}},[s._v("#")]),s._v(" 区分开发与生产环境")]),s._v(" "),n("p",[n("code",[s._v("webpack 4.x")]),s._v("引入了"),n("code",[s._v("mode")]),s._v("的概念，在运行"),n("code",[s._v("webpacks")]),s._v("时需要指定使用"),n("code",[s._v("production")]),s._v("还是"),n("code",[s._v("development")]),s._v("，这个功能说明我们需要具备运行两套构建环境的能力")]),s._v(" "),n("p",[s._v("当你指定了使用"),n("code",[s._v("production mode")]),s._v("时，默认会启动各种性能优化的功能，而"),n("code",[s._v("development mode")]),s._v("，则会开启debug工具，运行时打印详细错误信息。")]),s._v(" "),n("h3",{attrs:{id:"在配置文件中区分mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在配置文件中区分mode"}},[s._v("#")]),s._v(" 在配置文件中区分mode")]),s._v(" "),n("p",[s._v("之前我们的配置文件都是直接暴露一个"),n("code",[s._v("js")]),s._v("对象，这种方式无法获取到"),n("code",[s._v("mode")]),s._v("参数，所以我们要更换另外一种方式。")]),s._v(" "),n("p",[s._v("官文多种配置类型文档：https://webpack.docschina.org/configuration/configuration-types/")]),s._v(" "),n("p",[s._v("配置文件可以暴露一个函数")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("module.exports = (env, argv) => ({\n    // ...\n    optimization: {\n        minimize: false,\n        // 通过argv来获取mode\n        minimizer: argv.mode === 'production' ? [\n            // ... 自己的配置\n        ]:[]\n    }\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("这样获取mode之后，我们就能区分不同的构建环境，然后根据不通环境再对特殊的"),n("code",[s._v("loader")]),s._v("或"),n("code",[s._v("plugin")]),s._v("做额外配置")]),s._v(" "),n("h3",{attrs:{id:"拆分配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拆分配置"}},[s._v("#")]),s._v(" 拆分配置")]),s._v(" "),n("p",[s._v("我们可以将"),n("code",[s._v("webpack")]),s._v("的配置按照不同的环境拆分成多个文件，运行时直接根据环境变量加载对应的配置文件")]),s._v(" "),n("p",[s._v("举个爪子，当我们用"),n("code",[s._v("webpack")]),s._v("构建"),n("code",[s._v("vue")]),s._v("项目时,即"),n("code",[s._v("vue init webpack projectname")]),s._v(",我们可以看到"),n("code",[s._v("build")]),s._v("文件夹下已经区分了"),n("code",[s._v("mode")])]),s._v(" "),n("p",[s._v("根据这个例子，我们可以划分成下面几个文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("- webpack.base.js       基础部分，即共享的配置\n- webpack.dev.js        开发环境使用的配置\n- webpack.pro.js        生产环境使用的配置\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"如何处理这样的配置拆分"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何处理这样的配置拆分"}},[s._v("#")]),s._v(" 如何处理这样的配置拆分")]),s._v(" "),n("p",[s._v("对于"),n("code",[s._v("webpack")]),s._v("的配置，其实就是对外暴露一个"),n("code",[s._v("js")]),s._v("对象，所以对于这个对象，我们可以使用"),n("code",[s._v("js")]),s._v("代码来修改")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const config = {\n    // webpack配置\n}\n\nconfig.plugins.push(...) // 修改这个配置对象\n\nmodule.exports = config // 暴露这个对象\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("此外我们要有一个工具（"),n("code",[s._v("webpack-merge")]),s._v("）帮助我们合并多个配置对象，这样我们就可以很轻松地拆分"),n("code",[s._v("webpack")]),s._v("配置，然后判断当前的环境变量，使用工具将对应环境的配置对象整合后提供给"),n("code",[s._v("webpack")])]),s._v(" "),n("p",[s._v("举个爪子")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("基础共享部分（webpack.base.js\n\nmodule.exports = {\n    entry: ...,\n    output: {\n        ...\n    },\n    resolve: {\n        ...\n    },\n    module: {\n        ...\n    },\n    plugins: [\n        ...\n    ]\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("webpack.dev.js \n需求： 添加loader/plugin\n\nconst merge = require('webpack-merge')\nconst webpack = require('webpack')\nconst baseWebpackConfig = require('./webpack.base.js')\n\nmodule.exports = merga(baseWebpackConfig, {\n    module: {\n        rules: [\n            // 注意：当这里use的值是字符串或者是对象的话，会替换掉原本规则use的值\n            ... \n        ]\n    },\n    plugins: [\n        // plugins会与baseWebpackConfig中的plugins数组进行合并\n        ...\n    ]\n})\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);