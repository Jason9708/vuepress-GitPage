(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{179:function(s,n,a){"use strict";a.r(n);var e=a(0),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"通过webpack优化前端环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过webpack优化前端环境"}},[s._v("#")]),s._v(" 通过webpack优化前端环境")]),s._v(" "),a("h2",{attrs:{id:"优化前端资源加载-图片加载与代码压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化前端资源加载-图片加载与代码压缩"}},[s._v("#")]),s._v(" 优化前端资源加载 - 图片加载与代码压缩")]),s._v(" "),a("p",[s._v("我们总是希望浏览器在加载页面时用的时间越短越好，所以构建出来的文件应该越少越小越好，一来减少浏览器需要发起请求的数量，二来减少下载请求资源的时间")]),s._v(" "),a("p",[s._v("其实"),a("code",[s._v("webpack")]),s._v("把多个代码文件打包成几个必须的静态资源，已经很大程度减少了静态资源请求数量了")]),s._v(" "),a("p",[s._v("下面我们使用"),a("code",[s._v("webpack")]),s._v("实现更多的前端资源加载的优化需求")]),s._v(" "),a("h3",{attrs:{id:"css-sprites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css-sprites"}},[s._v("#")]),s._v(" Css Sprites")]),s._v(" "),a("p",[a("code",[s._v("Css Sprites")]),s._v("技术是前端领域一种常见的用于减少图片资源请求数的优化方式")]),s._v(" "),a("p",[s._v("如果使用的是"),a("code",[s._v("webpack 3.x")]),s._v("，需要"),a("code",[s._v("Css Sprites")]),s._v("的话，可以使用"),a("code",[s._v("webpack-spritesmith")]),s._v("或者"),a("code",[s._v("sprite-webpack-plugin")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("以webpack-spritesmith为例子，安装依赖  npm install webpack-spritesmith --save-dev\n\n修改webpack配置\n\nmodule: {\n    loader: [\n        // ... 这里需要有处理图片的loader，如file-loader\n    ]\n},\nresolve: {\n    modules: [\n        'node_modules',\n        'spritesmith-generated', // webpack-spritesmith 生产所需文件的目录\n    ]\n},\nplugins: [\n    new SpritesmithPlugin({\n        src: {\n            cwd: path.resovle(__dirname, 'src/ico'), // 多个图片所在的目录\n            glob: '*.png'  // 匹配图片的路径\n        },\n        target: {\n            // 生产最终图片的路径\n            image: path.resovle(__dirname, 'src/spritesmith-generated/sprite.png'),\n            // 生成所需 SASS/LESS/Stylus mixins代码，我们使用Stylus预处理器作为例子\n            css: path.resolve(__dirname, 'src/spritesmith-generated/sprite.styl'),\n        },\n        apiOptions: {\n            cssImgRef: \"~sprite.png\"\n        }\n    })\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("在你需要的样式代码中使用`sprite.styl`，只需引入后调用需要的`mixins`\n\n@import `~sprite.styl`\n\n.close-button\n    sprite($close)\n.open-button\n    sprite($open)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("❗ "),a("code",[s._v("webpack-spritesmith")]),s._v("和"),a("code",[s._v("sprite-webpack-plugin")]),s._v("还没更新到"),a("code",[s._v("webpack 4.x")]),s._v("，需要配合"),a("code",[s._v("postcss")]),s._v("和"),a("code",[s._v("postcss-sprites")]),s._v("，才能实现")])]),s._v(" "),a("h3",{attrs:{id:"图片压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片压缩"}},[s._v("#")]),s._v(" 图片压缩")]),s._v(" "),a("p",[s._v("图片资源会占用前端资源的很大一部分，"),a("code",[s._v("file-loader")]),s._v("可以用来处理图片文件，在次基础上，我们还可以再添加一个"),a("code",[s._v("image-webpack-loader")]),s._v("来压缩处理图片")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n    // ...\n    module: {\n        rules: [\n            {\n                test: /.*\\.(gif|png|jpe?g|svg|webp)$/i,\n                use: [\n                    {\n                        loader: 'file-loader',\n                        options: {}\n                    },\n                    {\n                        loader: 'image-webpack-loader',\n                        options: {\n                            mozjpeg: { // 压缩 jpeg 的配置\n                                progressive: true,\n                                quality: 65\n                            },\n                            optipng: { // 使用 imagemin-optipng 压缩 png，enable: false 为关闭\n                                enabled: false,\n                            },\n                            pngquant: { // 使用 imagemin-pngquant 压缩 png\n                                quality: '65-90',\n                                speed: 4\n                            },\n                            gifsicle: { // 压缩 gif 的配置\n                                interlaced: false,\n                            },\n                            webp: { // 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式\n                                quality: 75\n                            }\n                        }\n                    }\n                ]\n            }\n        ]\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("h3",{attrs:{id:"使用dataurl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用dataurl"}},[s._v("#")]),s._v(" 使用DataURL")]),s._v(" "),a("p",[s._v("有些时候我们会有一些很小的图片，并不想用"),a("code",[s._v("Css Sprites")]),s._v("的方式来处理，那么我们可以在"),a("code",[s._v("webpack")]),s._v("中使用"),a("code",[s._v("url-loader")]),s._v("来处理这些很小的图片 （常用）")]),s._v(" "),a("p",[a("code",[s._v("url-loader")]),s._v(" 与 "),a("code",[s._v("file-loader")]),s._v(" 的功能类似，但是在处理文件的时候，可以通过配置指定一个大小，当文件小于这个配置时，"),a("code",[s._v("url-loader")]),s._v("会将其转换成一个"),a("code",[s._v("base64")]),s._v("编码的"),a("code",[s._v("DataURL")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n    // ...\n    modules:{\n        rules: [\n            {\n                test: /\\.(png|jpg|gif)$/,\n                use: [\n                    {\n                        loader: 'url-loader',\n                        options: {\n                            limit: 8192, // 单位是 Byte，当文件小于 8KB 时作为 DataURL 处理\n                        },\n                    },\n                ],\n            }\n        ]\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"代码压缩"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码压缩"}},[s._v("#")]),s._v(" 代码压缩")]),s._v(" "),a("p",[a("code",[s._v("webpack 4.x")]),s._v("版本运行的时候，"),a("code",[s._v("mode")]),s._v("为"),a("code",[s._v("production")]),s._v("时会启动压缩"),a("code",[s._v("Js")]),s._v("的插件，而"),a("code",[s._v("webpack 3.x")]),s._v("，使用压缩"),a("code",[s._v("Js")]),s._v("代码插件的是"),a("code",[s._v("uglifyjs-webpack-plugin")])]),s._v(" "),a("p",[s._v("在生产环境中，压缩"),a("code",[s._v("Js")]),s._v("代码基本是一个必不可少的步骤，这样可以大大减小"),a("code",[s._v("JavaScript")]),s._v("的体积")]),s._v(" "),a("p",[s._v("除了压缩"),a("code",[s._v("Js")]),s._v("代码之外，我们还可以压缩"),a("code",[s._v("Html,Css")]),s._v("，虽然这种压缩只能移除空格换行等无功能性字符，但也能在一定程度上减小文件大小，在"),a("code",[s._v("webpack")]),s._v("中的配置使用也不是特别麻烦，所以我们通常也会使用")]),s._v(" "),a("p",[s._v("对于"),a("code",[s._v("HTML")]),s._v("文件，可以使用"),a("code",[s._v("html-webpack-plugin")]),s._v("插件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n  // ...\n  plugins: [\n    new HtmlWebpackPlugin({\n      filename: 'index.html', // 配置输出文件名和路径\n      template: path.join(__dirname, './src/index.html'),// 配置文件模板\n      minify: { // 压缩 HTML 的配置\n        minifyCSS: true, // 压缩 HTML 中出现的 CSS 代码\n        minifyJS: true // 压缩 HTML 中出现的 JS 代码\n      }\n    }),\n  ],\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("对于"),a("code",[s._v("css")]),s._v("文件，可以使用"),a("code",[s._v("css-loader")]),s._v("，也提供了压缩"),a("code",[s._v("CSS")]),s._v("代码的功能")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n  module: {\n    rules: [\n      // ...\n      {\n        test: /\\.css/,\n        include: [\n          path.resolve(__dirname, 'src'),\n        ],\n        use: [\n          'style-loader',\n          {\n            loader: 'css-loader',\n            options: {\n              minimize: true, // 使用 css 的压缩功能\n            },\n          },\n        ],\n      },\n    ],\n  }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("在"),a("code",[s._v("css-loader")]),s._v("的选项中配置"),a("code",[s._v("minimize")]),s._v("字段为"),a("code",[s._v("true")]),s._v("来使用"),a("code",[s._v("css")]),s._v("压缩代码的功能")]),s._v(" "),a("p",[a("code",[s._v("css-loader")]),s._v("是使用"),a("code",[s._v("cssnano")]),s._v("来压缩代码的，"),a("code",[s._v("minimize")]),s._v("字段也可以配置为一个对象，来将相关配置传递给 "),a("code",[s._v("cssnano")])]),s._v(" "),a("p",[s._v("关于"),a("code",[s._v("cssnano")]),s._v("内容可参考 https://cssnano.co/")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"优化前端资源加载-分离代码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化前端资源加载-分离代码文件"}},[s._v("#")]),s._v(" 优化前端资源加载 - 分离代码文件")]),s._v(" "),a("p",[s._v("如何利用浏览器的缓存以及在"),a("code",[s._v("webpack")]),s._v("中实现按需加载代码")]),s._v(" "),a("h3",{attrs:{id:"分离代码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分离代码文件"}},[s._v("#")]),s._v(" 分离代码文件")]),s._v(" "),a("p",[s._v("关于分离"),a("code",[s._v("css")]),s._v("文件，我们可以使用"),a("code",[s._v("webpack")]),s._v("中的"),a("code",[s._v("extract-text-webpack-plugin")]),s._v("插件")]),s._v(" "),a("p",[a("strong",[s._v("为什么要把"),a("code",[s._v("css")]),s._v("文件分离出来，而不是直接一起打包在"),a("code",[s._v("Js")]),s._v("中？")])]),s._v(" "),a("p",[s._v("最主要的原因是我们希望更好地利用缓存，假设我们原本页面的静态资源都打包成一个"),a("code",[s._v("Js")]),s._v("文件，加载页面时虽然只需要加载一个"),a("code",[s._v("Js")]),s._v("文件，\n但一旦我们的代码改变了，用户访问新的页面时就需要重新加载一个新的"),a("code",[s._v("Js")]),s._v("文件。有些情况下，我们只是单独修改了样式，这样也要重新加载整个应用的"),a("code",[s._v("Js")]),s._v("文件，是很不划算的")]),s._v(" "),a("p",[s._v("还有一种情况是我们有多个页面，它们都可以共用一部分样式，如果每个页面都单独打包成一个"),a("code",[s._v("Js")]),s._v("文件，那么每次访问页面都会重复加载原本可以共享的"),a("code",[s._v("Css")]),s._v("代码。")]),s._v(" "),a("p",[s._v("而如果是分离开，第二个页面就有了"),a("code",[s._v("Css")]),s._v("文件的缓存，访问速度自然更快，虽然对第一个页面来说多了一个请求，但缓存带来的速度提升是更可观的")]),s._v(" "),a("p",[a("strong",[s._v("那么如何使用webpacl来把代码中公共使用的部分分离成独立的文件呢？")])]),s._v(" "),a("p",[a("code",[s._v("webpack 4.x")]),s._v("与"),a("code",[s._v("webpack 3.x")]),s._v("在代码分离这部分的做法区别较大")]),s._v(" "),a("p",[a("code",[s._v("webpack 3.x")]),s._v("以前的版本是使用"),a("code",[s._v("CommonsChunkPlugin")]),s._v("来做代码分离的，而"),a("code",[s._v("webpack 4.x")]),s._v("则是把功能移到了"),a("code",[s._v("optimize.splitChunks")]),s._v("中，直接使用该配置就可以实现代码分离")]),s._v(" "),a("h4",{attrs:{id:"webpack-4-x-的-optimization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-4-x-的-optimization"}},[s._v("#")]),s._v(" webpack 4.x 的 optimization")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('module.exports = {\n    // ... webpack配置\n    optimization: {\n        splitChunks: {\n            chunk: "all",  // 所有的chunks代码公共的部分分离出来成为一个单独的文件\n        }\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("我们需要在"),a("code",[s._v("HTML")]),s._v("中引用两个构建出来的"),a("code",[s._v("Js")]),s._v("文件，并且"),a("code",[s._v("common.js")]),s._v("需要在入口代码之前，下面是个简单的例子")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('<script src="commons.js" charset="utf-8"><\/script>\n<script src="entry.bundle.js" charset="utf-8"><\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("之前我们提到拆分文件是为了更好地利用缓存，分离公共类库很大程度上是为了让多页面利用缓存，从而减少下载的代码量，同时，也有代码变更时可以利用缓存减少下载代码量的好处。从这个角度出发，个人建议将公共使用的第三方类库显式地配置为公共的部分，而不是 webpack 自己去判断处理。因为公共的第三方类库通常升级频率相对低一些，这样可以避免因公共 chunk 的频繁变更而导致缓存失效。")]),s._v(" "),a("p",[a("strong",[s._v("显式配置共享类库操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('module.exports = {\n  entry: {\n    vendor: ["react", "lodash", "angular", ...], // 指定公共使用的第三方类库\n  },\n  optimization: {\n    splitChunks: {\n      cacheGroups: {\n        vendor: {\n          chunks: "initial",\n          test: "vendor",\n          name: "vendor", // 使用 vendor 入口作为公共部分\n          enforce: true,\n        },\n      },\n    },\n  },\n  // ... 其他配置\n}\n\n// 或者\nmodule.exports = {\n  optimization: {\n    splitChunks: {\n      cacheGroups: {\n        vendor: {\n          test: /react|angluar|lodash/, // 直接使用 test 来做路径匹配\n          chunks: "initial",\n          name: "vendor",\n          enforce: true,\n        },\n      },\n    },\n  },\n}\n\n// 或者\nmodule.exports = {\n  optimization: {\n    splitChunks: {\n      cacheGroups: {\n        vendor: {\n          chunks: "initial",\n          test: path.resolve(__dirname, "node_modules") // 路径在 node_modules 目录下的都作为公共部分\n          name: "vendor", // 使用 vendor 入口作为公共部分\n          enforce: true,\n        },\n      },\n    },\n  },\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("p",[s._v("上述第一种做法是显示指定哪些类库作为公共部分，第二种做法实现的功能差不多，只是利用了 test 来做模块路径的匹配，第三种做法是把所有在 node_modules 下的模块，即作为依赖安装的，都作为公共部分。你可以针对项目情况，选择最合适的做法。")]),s._v(" "),a("h4",{attrs:{id:"webpack-3-x-的-commonschunkplugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-3-x-的-commonschunkplugin"}},[s._v("#")]),s._v(" webpack 3.x 的 CommonsChunkPlugin")]),s._v(" "),a("p",[a("code",[s._v("webpack 3.x")]),s._v("以下的版本需要用到"),a("code",[s._v("webpack")]),s._v("自身提供的"),a("code",[s._v("CommonsChunkPlugin")]),s._v("插件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n    // ...\n    plugins: [\n        new webpack.optimize.CommonsChunkPlugin({\n            name: 'commons', // 公共使用的chunk的名称\n            filename: 'commons.js', // 公共chunk的生成文件名\n            minChunks：3, // 公共的部分必须被3个chunk共享\n        })\n    ]\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("code",[s._v("chunk")]),s._v("在这里是构建的主干，可以简单理解为一个入口对应一个"),a("code",[s._v("chunk")])]),s._v(" "),a("p",[s._v("以上插件配置的构建后会生成一个"),a("code",[s._v("commons.js")]),s._v("文件，该文件就是代码中的公共部分，上面的配置中"),a("code",[s._v("minChunks")]),s._v("为3，意思是当一个模块被3个以上的"),a("code",[s._v("chunk")]),s._v("依赖时，这个模块就会被划分到"),a("code",[s._v("commons")]),s._v("chunk中去。")]),s._v(" "),a("p",[a("code",[s._v("CommonsChunkPlugin")]),s._v("也是支持显示配置共享类库的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("module.exports = {\n  entry: {\n    vendor: ['react', 'react-redux'], // 指定公共使用的第三方类库\n    app: './src/entry',\n    // ...\n  },\n  // ...\n  plugins: [\n    new webpack.optimize.CommonsChunkPlugin({\n      name: 'vendor' // 使用 vendor 入口作为公共部分\n      filename: \"vendor.js\", \n      minChunks: Infinity, // 这个配置会让 webpack 不再自动抽离公共模块\n    }),\n  ],\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("上述配置会生成一个名为"),a("code",[s._v("vandor.js")]),s._v("的共享代码文件，里面包含了"),a("code",[s._v("React")]),s._v("和"),a("code",[s._v("React-Redux")]),s._v("库的代码，可以提供给多个不同的入口代码使用。")]),s._v(" "),a("p",[s._v("这里"),a("code",[s._v("minChunks")]),s._v("配置使用了"),a("code",[s._v("Infinity")]),s._v("，可以理解为"),a("code",[s._v("webpack")]),s._v("不自动抽离公共模块。（如果这里指定了3，那么被3个以上的"),a("code",[s._v("chunk")]),s._v("依赖的模块会和"),a("code",[s._v("React，React-Redux")]),s._v("一同打包进"),a("code",[s._v("vendor")]),s._v(",这样就失去显示指定的意义")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"优化前端资源加载-进一步控制js大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化前端资源加载-进一步控制js大小"}},[s._v("#")]),s._v(" 优化前端资源加载 - 进一步控制Js大小")]),s._v(" "),a("h3",{attrs:{id:"按需加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#按需加载"}},[s._v("#")]),s._v(" 按需加载")]),s._v(" "),a("p",[s._v("前面讲述如何将大的代码文件进行拆分，抽离出多个页面共享的代码文件，但是当你的"),a("code",[s._v("Web")]),s._v("应用是个单页面应用(Vue),并且及其复杂的时候，你会发现有一些代码并不是每一个用户都需要用到的。")]),s._v(" "),a("p",[s._v("我们希望可以将这一部分代码抽离出去，仅当用户真正需要用到时才加载，这时就可以使用"),a("code",[s._v("webpack")]),s._v("的按需加载功能")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("webpack")]),s._v("的构建环境中，要按需加载代码模块很简单，遵循"),a("code",[s._v("ES")]),s._v("标准的动态加载语法"),a("code",[s._v("dynamic-import")]),s._v("来编写代码即可，"),a("code",[s._v("webpack")]),s._v("会自动处理使用该语法编写的模块")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// import 作为一个方法使用，传入模块名即可，返回一个Promise对象来获取模块暴露的对象\n\nimport('lodash').then( _ => {\n    console.log(_.lash([1,2,3])) // 打印3\n})\n\n\n这里,webpack构建时会自动把lodash模块分离出来，并且在代码内部实现动态加载lodash的功能\n\n动态加载代码模块依赖于网络，所以模块内容会异步返回，\n\n因此import方法需要返回一个promise来获取动态加载的模块内容\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("strong",[s._v("❗ 如果使用了"),a("code",[s._v("Babel")]),s._v("的话，还需要"),a("code",[s._v("Syntax Dynamic Import")]),s._v("这个"),a("code",[s._v("Babel")]),s._v("插件来处理"),a("code",[s._v("import()")]),s._v("这种语法")])]),s._v(" "),a("p",[s._v("由于动态加载代码模块的语法依赖于"),a("code",[s._v("promise")]),s._v("，对于低版本的浏览器，需要添加"),a("code",[s._v("promise")]),s._v("的"),a("code",[s._v("polyfill")]),s._v("后才能使用")]),s._v(" "),a("h3",{attrs:{id:"tree-shaking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking"}},[s._v("#")]),s._v(" Tree Shaking")]),s._v(" "),a("p",[a("code",[s._v("Tree Shaking")]),s._v("可以移除"),a("code",[s._v("Js")]),s._v("上下文中的未引用代码，删除用不着的代码，能够有效减少"),a("code",[s._v("JS")]),s._v("代码文件的大小")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("官方例子\n\n// src/math.js\nexport function square(x) {\n    return x * x\n}\nexport function cube(x) {\n    return x * x * x\n}\n\n// src/index.js\nimport { cube } from './math.js'\nconsole.log(cube(3))\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("很明显，"),a("code",[s._v("square")]),s._v("这个方法未被引用，是可以删掉的。")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("webpack")]),s._v("中，只有启动了"),a("code",[s._v("Js")]),s._v("代码压缩功能（即使用 "),a("code",[s._v("uglify")]),s._v("）时，会做"),a("code",[s._v("Tree shaking")]),s._v("优化")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("webpack 4.x")]),s._v("需要指定"),a("code",[s._v("mode")]),s._v("为"),a("code",[s._v("production")])]),s._v(" "),a("li",[a("code",[s._v("webpack 3.x")]),s._v("需要配置"),a("code",[s._v("UglifyJsPlugin")])])]),s._v(" "),a("p",[s._v("启动之后，构建出来的包就会移除"),a("code",[s._v("square")]),s._v("这部分代码")]),s._v(" "),a("p",[a("strong",[s._v("PS:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('如果你在项目中使用了Babel的话，要把Babel解析模块语法的功能关掉，在.babelrc配置中增加 "modules":false 这个配置\n\n\n// .babelrc\n{\n    "presets":[["env",{ "modules": false }]]\n}\n\n这样可以把`import/export`这一部分模块语法交由`webpack`处理，否则无法使用`Tree Shaking`的优化\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);